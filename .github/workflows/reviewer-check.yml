name: Reviewer Check

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-reviewers:
    runs-on: ubuntu-latest
    steps:
      - name: Check Reviewers
        uses: actions/github-script@v7
        with:
          script: |
            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number
            });
            
            const reviewers = pr.requested_reviewers || [];
            const teamReviewers = pr.requested_teams || [];
            const totalReviewers = reviewers.length + teamReviewers.length;
            
            console.log(`ğŸ“‹ Reviewers: ${totalReviewers}`);
            console.log(`ğŸ‘¤ Individual reviewers: ${reviewers.map(r => r.login).join(', ')}`);
            console.log(`ğŸ‘¥ Team reviewers: ${teamReviewers.map(t => t.slug).join(', ')}`);
            
            if (totalReviewers === 0) {
              core.setFailed('âŒ No reviewers assigned. Please assign at least one reviewer to proceed.');
              
              // ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
              const comment = `
              ## âš ï¸ ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼æœªæŒ‡å®š
              
              **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: #${context.issue.number}
              
              ### âŒ å•é¡Œ
              ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
              
              ### âœ… è§£æ±ºæ–¹æ³•
              1. ã“ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å³å´ã®ã€ŒReviewersã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ã‚’è¿½åŠ 
              2. ã¾ãŸã¯ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆã§ \`@username\` ã‚’æŒ‡å®š
              
              ### ğŸ“‹ æ¨å¥¨ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼
              - @amemboWorks
              - ã¾ãŸã¯ã€é©åˆ‡ãªãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼
              
              ---
              ğŸ¤– è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã§ã™
              `;
              
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: comment
              });
            } else {
              console.log('âœ… Reviewers are assigned');
              
              // æˆåŠŸã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
              const reviewerList = reviewers.map(r => `@${r.login}`).join(', ');
              const teamList = teamReviewers.map(t => `@${t.slug}`).join(', ');
              
              const comment = `
              ## âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ç¢ºèªå®Œäº†
              
              **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: #${context.issue.number}
              
              ### ğŸ‘¥ æŒ‡å®šã•ã‚ŒãŸãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼
              ${reviewerList} ${teamList}
              
              ### ğŸ“‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
              1. ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ã‹ã‚‰ã®æ‰¿èªã‚’å¾…æ©Ÿ
              2. æ‰¿èªå¾Œã€ãƒãƒ¼ã‚¸ãŒå¯èƒ½ã«ãªã‚Šã¾ã™
              
              ---
              ğŸ¤– è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã§ã™
              `;
              
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: comment
              });
            } 